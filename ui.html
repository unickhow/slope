<div id="app">
  <div v-cloak v-scope>
    <div class="string-switcher">
      <div class="form-group">
        <input v-show="!isReverseStringNumber" v-model="textString" type="text" id="prefix-head" class="input" style="text-align: right;" placeholder="SKU" tabindex="1">
        <input v-show="isReverseStringNumber" v-model="numberString" type="text" id="base-number-head" class="input" style="text-align: right;" placeholder="0013845" tabindex="2">
      </div>
      <button class="btn-swap button is-white" @click="isReverseStringNumber = !isReverseStringNumber">
        <img width="30" height="30" src="https://cdn-icons-png.flaticon.com/512/7305/7305080.png" alt="">
      </button>
      <div class="form-group">
        <input v-show="!isReverseStringNumber" v-model="numberString" type="text" id="base-number-tail" class="input" placeholder="0013845" tabindex="2">
        <input v-show="isReverseStringNumber" v-model="textString" type="text" id="prefix-tail" class="input" placeholder="SKU" tabindex="1">
      </div>
    </div>
    <div class="form-group">
      <div class="control">
        <label class="radio">
          <input v-model="orderDirection" type="radio" name="order" value="asc" tabindex="3">
          Asc
        </label>
        <label class="radio">
          <input v-model="orderDirection" type="radio" name="order" value="desc" tabindex="4">
          Desc
        </label>
      </div>
    </div>
    <div class="btn-group">
      <button id="cancel" class="button is-info is-inverted" tabindex="6" @click="handleCancel">Cancel</button>
      <button id="generate" class="button is-info" :disabled="!isAllowGenerate" tabindex="5" @click="handleGenerate">Generate</button>
    </div>
  </div>
</div>

<script type="module">
  import { createApp } from 'https://unpkg.com/petite-vue?module'

  document.getElementById('base-number-head').oninput = (e) => {
    e.target.value = e.target.value.replace(/[^0-9]/g, '').replace(/(\..*)\./g, '$1')
  }
  document.getElementById('base-number-tail').oninput = (e) => {
    e.target.value = e.target.value.replace(/[^0-9]/g, '').replace(/(\..*)\./g, '$1')
  }

  createApp({
    textString: '',
    numberString: '',
    orderDirection: 'asc',
    isReverseStringNumber: false,
    get isAllowGenerate () {
      return !!this.textString && !!this.numberString
    },
    handleGenerate () {
      const prefix = this.textString;
      const baseNumber = this.numberString;
      const order = this.orderDirection;
      const isReverse = this.isReverseStringNumber
      parent.postMessage({
        pluginMessage: {
          type: 'generate',
          prefix,
          baseNumber,
          order,
          isReverse
        }
      }, '*')
    },

    handleCancel () {
      parent.postMessage({ pluginMessage: { type: 'cancel' } }, '*')
    }
  }).mount()
</script>

<style>
  @import "https://cdn.jsdelivr.net/npm/bulma@0.9.2/css/bulma.min.css";
  #app {
    padding: 1rem;
  }
  #app [v-cloak] {
    display: none;
  }
  #app .form-group {
    display: flex;
  }
  #app .form-group input[type=radio] {
    margin-left: 1rem;
  }
  #app .btn-group {
    display: flex;
    margin-top: 4rem;
  }
  #app .btn-group #cancel {
    width: 80px;
  }
  #app .btn-group #generate {
    width: 100%;
  }
  #app .string-switcher {
    display: flex;
    margin-bottom: 1rem;
  }
  #app .string-switcher .btn-swap {
    margin: 0 .5rem;
  }
</style>
